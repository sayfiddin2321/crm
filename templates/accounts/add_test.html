{% load static %}
<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <title>üìù Test qo‚Äòshish</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    body { background: #f3f6fb; font-family: "Segoe UI", sans-serif; }
    .card { border-radius: 16px; border: none; }
    .question { border: 1px solid #dee2e6; padding: 15px; margin-bottom: 15px; border-radius: 8px; background: #fff; }
    .remove-btn { color: red; cursor: pointer; font-size: 18px; margin-left: 10px; }
  </style>
</head>
<body>
<div class="container mt-4">
<a href="{% url 'accounts:index' %}" class="btn-back" title="Ortga qaytish">
    <i class="fas fa-arrow-left"></i>
  </a><br>
  {% if messages %}
    {% for m in messages %}
      <div class="alert alert-success rounded-3 shadow">{{ m }}</div>
    {% endfor %}
  {% endif %}

  <div class="card shadow p-4 mb-4">
    <h3 class="text-primary mb-3"><i class="fa fa-plus"></i> Yangi test qo‚Äòshish</h3>
    <form method="post">
      {% csrf_token %}
      <div class="mb-3">
        <label>Test nomi</label>
        <input type="text" name="title" class="form-control" required>
      </div>
      <div class="mb-3">
        <label>Test izohi</label>
        <textarea name="description" class="form-control"></textarea>
      </div>
      <h5 class="text-primary"><i class="fa fa-question-circle"></i> Savollar</h5>
      <div id="questions"></div>
      <button type="button" class="btn btn-outline-primary mt-2" onclick="addQuestion()">
        <i class="fa fa-plus"></i> Savol qo‚Äòshish
      </button>
      <button type="submit" class="btn btn-primary w-100 mt-3">
        <i class="fa fa-check"></i> Saqlash
      </button>
    </form>
  </div>

  <div class="card shadow p-4">
    <h3 class="text-primary mb-3"><i class="fa fa-list"></i> Mening testlarim</h3>
    {% if tests %}
    <div class="table-responsive rounded-3 shadow-sm">
      <table class="table table-striped table-hover align-middle mb-0">
        <thead class="table-primary text-center">
          <tr>
            <th>#</th>
            <th>Nomi</th>
            <th>Izoh</th>
            <th>Amal</th>
          </tr>
        </thead>
        <tbody>
          {% for test in tests %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ test.title }}</td>
            <td>{{ test.description|default:"-" }}</td>
            <td class="text-center">
              <form method="post" action="{% url 'accounts:delete_test' test.pk %}" style="display:inline;">
                {% csrf_token %}
                <button class="btn btn-danger btn-sm rounded-3" onclick="return confirm('Aniq o‚Äòchirmoqchimisiz?')">
                  <i class="fa fa-trash"></i> O‚Äòchirish
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <div class="alert alert-warning mt-3 rounded-3">
        Sizda hali test mavjud emas.
      </div>
    {% endif %}
  </div>
</div>

<script>
let questionCount = 0;
function addQuestion() {
  const questionsDiv = document.getElementById('questions');
  const qDiv = document.createElement('div');
  qDiv.classList.add('question');
  qDiv.innerHTML = `
    <label>Savol</label>
    <input type="text" name="question_text_${questionCount}" class="form-control mb-2" required>
    <span class="remove-btn" onclick="this.parentElement.remove()"><i class="fa fa-trash"></i></span>
    <div class="answers mt-2">
      <h6>Variantlar</h6>
      <div class="mb-2 d-flex gap-2">
        <input type="text" name="answers_${questionCount}[]" class="form-control" placeholder="variant" required>
        <input type="checkbox" name="correct_${questionCount}[]" value="0"> To‚Äòg‚Äòri
      </div>
      <div class="mb-2 d-flex gap-2">
        <input type="text" name="answers_${questionCount}[]" class="form-control" placeholder="variant" required>
        <input type="checkbox" name="correct_${questionCount}[]" value="1"> To‚Äòg‚Äòri
      </div>
      <button type="button" class="btn btn-sm btn-outline-primary mt-2" onclick="addAnswer(this, ${questionCount})">
        <i class="fa fa-plus"></i> Variant qo‚Äòshish
      </button>
    </div>
  `;
  questionsDiv.appendChild(qDiv);
  questionCount++;
}
function addAnswer(button, qIndex) {
  const answersDiv = button.parentElement;
  const count = answersDiv.querySelectorAll("input[type='text']").length;
  answersDiv.insertAdjacentHTML('beforeend', `
    <div class="mb-2 d-flex gap-2">
      <input type="text" name="answers_${qIndex}[]" class="form-control" placeholder="variant" required>
      <input type="checkbox" name="correct_${qIndex}[]" value="${count}"> To‚Äòg‚Äòri
    </div>
  `);
}
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

